from telegram import InlineKeyboardButton, InlineKeyboardMarkup, WebAppInfo
from telegram.ext import Application, CommandHandler, ContextTypes
from telegram.error import BadRequest
from telegram.ext import CallbackQueryHandler

# List of channel usernames (without @)
REQUIRED_CHANNELS = ['EarningScripter1', 'ES_Proofs']

# Bot token
BOT_TOKEN = '7856483777:AAHIw-nBNLaetj1uc7_SeWvdmNfgaXAKjro'


async def start(update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.message.from_user.id
    channels_not_joined = []

    # Check if the user has joined each channel
    for channel in REQUIRED_CHANNELS:
        try:
            member = await context.bot.get_chat_member(f'@{channel}', user_id)
            if member.status not in ['member', 'administrator', 'creator']:
                channels_not_joined.append(channel)
        except BadRequest:
            await update.message.reply_text(f"Bot is not an admin in @{channel}. Please add the bot as an admin.")
            return

    # If there are channels the user hasn't joined, prompt them to join
    if channels_not_joined:
        buttons = [
            [InlineKeyboardButton(f'Join @{channel}', url=f'https://t.me/{channel}') for channel in REQUIRED_CHANNELS],
            [InlineKeyboardButton('Joined All Channelâœ…', url=f'https://t.me/ColourScript_bot?start=RomakeOp')]
        ]
        
        await update.message.reply_text(
            "Please join all the required channels to continue:",
            reply_markup=InlineKeyboardMarkup(buttons),
        )
    else:
        # If user has joined all channels, show welcome message with login URL buttons and image
        welcome_buttons = [
            [InlineKeyboardButton("91 Club Hack", web_app=WebAppInfo(url="https://romake.in/CrackSniper/91club.html")), InlineKeyboardButton("55 Club Hack", web_app=WebAppInfo(url="https://romake.in/CrackSniper/55club.html"))],
            [InlineKeyboardButton("In999 Hack", web_app=WebAppInfo(url="https://romake.in/CrackSniper/In999.html")), InlineKeyboardButton("Ok Win Hack", web_app=WebAppInfo(url="https://romake.in/CrackSniper/okwin.html"))],
            
            [InlineKeyboardButton("Big Mumbai Hack", web_app=WebAppInfo(url="https://romake.in/CrackSniper/BigMumbai.html")), InlineKeyboardButton("Big Daddy Game Hack", web_app=WebAppInfo(url="https://romake.in/CrackSniper/bdg.html"))],
            [InlineKeyboardButton("Tiranga Hack", web_app=WebAppInfo(url="https://romake.in/CrackSniper/Tiranga.html")), InlineKeyboardButton("Daman Hack", web_app=WebAppInfo(url="https://romake.in/CrackSniper/daman.html"))],
            
            [InlineKeyboardButton("Goa Game Hack", web_app=WebAppInfo(url="https://romake.in/CrackSniper/goagame.html")), InlineKeyboardButton("DiuWin Hack", web_app=WebAppInfo(url="https://romake.in/CrackSniper/diuwin.html"))],
            
            [InlineKeyboardButton("Sikkim Hack", web_app=WebAppInfo(url="https://romake.in/CrackSniper/sikkim.html")), InlineKeyboardButton("51 Game Hack", web_app=WebAppInfo(url="https://romake.in/CrackSniper/51.html"))],
             
            [InlineKeyboardButton("TC Lottery Hack", web_app=WebAppInfo(url="https://romake.in/CrackSniper/tclottery.html")), InlineKeyboardButton("Big Win Hack", web_app=WebAppInfo(url="https://romake.in/CrackSniper/bdgwin.html"))],
            [InlineKeyboardButton("RangGame Hack", url=f'https://colorsignup.github.io/ES1/rang')]
            [InlineKeyboardButton("Apk Download", web_app=WebAppInfo(url="https://apksdownload.github.io/Mix-Hack-v3.0")), InlineKeyboardButton("Customer Care", url=f'https://t.me/EarningScripter1_bot')],
            
            [InlineKeyboardButton("Join Telegram", url=f'https://t.me/EarningScripter1')]
        ]
        await context.bot.send_photo(
            chat_id=user_id,
            photo='romake.jpg',  # replace with your image URL or file ID
            caption="Welcome to the bot! Choose an option below:",
            reply_markup=InlineKeyboardMarkup(welcome_buttons)
        )


def main():
    # Initialize the application
    application = Application.builder().token(BOT_TOKEN).build()

    # Command handler to start the bot
    application.add_handler(CommandHandler('start', start))

    # Start the bot
    application.run_polling()

if __name__ == '__main__':
    main()
    